(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85890,34662,77241,81092,e=>{"use strict";let t=Symbol.for("constructDateFrom");function s(e,s){return"function"==typeof e?e(s):e&&"object"==typeof e&&t in e?e[t](s):e instanceof Date?new e.constructor(s):new Date(s)}function r(e,t){return s(t||e,e)}function a(e,t){let s=r(e,t?.in);return s.setHours(0,0,0,0),s}e.s(["constructFromSymbol",0,t,"millisecondsInDay",0,864e5,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],34662),e.s(["constructFrom",()=>s],77241),e.s(["toDate",()=>r],81092),e.s(["startOfDay",()=>a],85890)},45963,e=>{"use strict";var t=e.i(81092);function s(e,s){let r=(0,t.toDate)(e,s?.in);return r.setHours(23,59,59,999),r}e.s(["endOfDay",()=>s])},73292,e=>{"use strict";var t=e.i(43476),s=e.i(63178);function r({children:e,...r}){return(0,t.jsx)(s.ThemeProvider,{...r,children:e})}e.s(["ThemeProvider",()=>r])},34123,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(73328),a=e.i(11795);class i{supabase=a.supabase;async loginWithPassword(e,t){let{data:s,error:r}=await this.supabase.auth.signInWithPassword({email:e,password:t});if(r)throw r;if(!s.user||!s.session)throw Error("Login failed");let{data:a,error:i}=await this.supabase.from("crm_users").select("id").eq("email",s.user.email).maybeSingle();if(i)throw console.error("CRM User check error:",i),await this.signOut(),Error("Access Check Failed");if(!a)throw await this.signOut(),Error("Access Denied: You are not authorized to access this CRM.");return{user:s.user,session:s.session}}async loginWithEmail(e){let{error:t}=await this.supabase.auth.signInWithOtp({email:e,options:{shouldCreateUser:!1}});if(t)throw t}async verifyOtp(e,t){let{data:s,error:r}=await this.supabase.auth.verifyOtp({email:e,token:t,type:"email"});return{session:s.session,user:s.user,error:r}}async currentUser(){let{data:{user:e}}=await this.supabase.auth.getUser();return e}async signOut(){await this.supabase.auth.signOut()}onAuthStateChange(e){return this.supabase.auth.onAuthStateChange(e)}}e.i(47167);class n{supabaseUrl="https://iseeskrjduslooowowcc.supabase.co";supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzZWVza3JqZHVzbG9vb3dvd2NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwODc1NzgsImV4cCI6MjA4MzY2MzU3OH0.bGzpynAaXD6N2HeOb2rfM4CCDZnkDb6tWRfSCQ7XvKc";async getEvents({venueId:e,filter:t="all",page:s=1,pageSize:r=10,search:a,startDate:i,endDate:n}){let o={venueId:e,filter:t,page:s.toString(),pageSize:r.toString()};if(a&&(o.search=a),i){let e=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),s=String(i.getDate()).padStart(2,"0");o.startDate=`${e}-${t}-${s}`}if(n){let e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");o.endDate=`${e}-${t}-${s}`}let u=new URLSearchParams(o),c=await fetch(`${this.supabaseUrl}/functions/v1/getAllEvents?${u}`,{headers:{Authorization:`Bearer ${this.supabaseAnonKey}`,"Content-Type":"application/json"}});if(!c.ok)throw Error((await c.json().catch(()=>({}))).error||"Failed to fetch events");return await c.json()}async getEvent(e){let t=new URLSearchParams({eventId:e}),s=await fetch(`${this.supabaseUrl}/functions/v1/getEvent?${t}`,{headers:{Authorization:`Bearer ${this.supabaseAnonKey}`,"Content-Type":"application/json"}});if(!s.ok)throw Error((await s.json().catch(()=>({}))).error||"Failed to fetch event");return await s.json()}}var o=e.i(85890),u=e.i(45963);class c{async getGuestRequests(e,t,s,r,i,n){let c=a.supabase.from("guest_list_requests").select(`
        *,
        user:users!guest_list_requests_requested_by_fkey (
          id, first_name, last_name, gender_id, dob, photo_urls,
          gender:genders!users_gender_id_fkey(name)
        ),
        event:events!guest_list_requests_event_id_fkey (
          id, name:title, start_time:starts_at
        )
      `).order("created_at",{ascending:!1});if(e&&(c=c.eq("venue_id",e),s)){let e=(0,o.startOfDay)(s).toISOString(),t=(0,u.endOfDay)(s).toISOString();c=c.or(`and(created_at.gte.${e},created_at.lte.${t}),status.eq.pending`)}t&&(c=c.eq("event_id",t)),r&&"all"!==r&&(c="cancelled"===r?c.in("status",["cancelled","cancelled_by_venue","cancelled_by_user"]):c.eq("status",r)),void 0!==i&&void 0!==n&&(c=c.range(n,n+i-1));let{data:l,error:d}=await c;if(d)throw console.error("Error fetching guest requests:",d),d;return l}async approveGuestRequest(e){let{data:{user:t}}=await a.supabase.auth.getUser();if(!t)throw Error("Not authenticated");let{error:s}=await a.supabase.from("guest_list_requests").update({status:"approved",approved_by:t.id,approved_at:new Date().toISOString()}).eq("id",e);if(s)throw s;let{data:r}=await a.supabase.from("guest_list_requests").select("requested_by, guests").eq("id",e).single();if(r){let t=[{guest_request_id:e,user_id:r.requested_by}];r.guests&&r.guests.length>0&&r.guests.forEach(s=>{t.push({guest_request_id:e,user_id:s})});let{error:s}=await a.supabase.from("guest_list_members").insert(t);s&&console.error("Error adding to guest_list_members:",s)}}async denyGuestRequest(e){let{error:t}=await a.supabase.from("guest_list_requests").update({status:"cancelled_by_venue"}).eq("id",e);if(t)throw t}async cancelGuestRequest(e){let{error:t}=await a.supabase.from("guest_list_requests").update({status:"cancelled_by_venue"}).eq("id",e);if(t)throw t}async getVenueEvents(e){let{data:t,error:s}=await a.supabase.from("events").select("id, title, starts_at").eq("venue_id",e).order("starts_at",{ascending:!1});return s?(console.error("Error fetching venue events:",s),[]):t.map(e=>({...e,name:e.title,start_time:e.starts_at}))}async getStats(e,t,s){let r=a.supabase.from("guest_list_requests").select("status, created_at").eq("venue_id",e);if(t)r=r.eq("event_id",t);else if(s){let e=(0,o.startOfDay)(s).toISOString(),t=(0,u.endOfDay)(s).toISOString();r=r.gte("created_at",e).lte("created_at",t)}let{data:i,error:n}=await r;if(n)return console.error("Error fetching stats:",n),{totalInvited:0,checkedIn:0,invited:0,noShows:0,noShowRate:0,capacity:0};let{data:c}=await a.supabase.from("venues").select("person_limit").eq("id",e).single(),l=i?.filter(e=>"approved"===e.status).length||0,d=i?.filter(e=>"used"===e.status).length||0,_=i?.filter(e=>"no_show"===e.status).length||0,m=i?.filter(e=>"pending"===e.status).length||0,g=l+d+_,p=g>0?Math.round(_/g*100):0;return{totalInvited:g,checkedIn:d,invited:m,noShows:_,noShowRate:p,capacity:c?.person_limit||0}}}class l{async getPromoters(e){if(console.log("SupabasePromotersRepository: getPromoters called with companyId:",e),!e)return console.warn("SupabasePromotersRepository: companyId is missing"),[];let{count:t,error:s}=await a.supabase.from("crm_users").select("*",{count:"exact",head:!0});console.log("SupabasePromotersRepository: Total crm_users in DB:",t,"Error:",s);let{data:r,error:i}=await a.supabase.from("crm_users").select(`
        id,
        name,
        surname,
        email,
        role,
        status,
        created_at,
        crm_user_companies!inner(company_id)
      `).eq("crm_user_companies.company_id",e).order("created_at",{ascending:!1});if(i)return console.error("Error fetching promoters:",i),[];let{data:n,error:o}=await a.supabase.from("guest_list_requests").select("id, requested_by, event_id, guests");o&&console.error("Error fetching requests",o);let{data:u,error:c}=await a.supabase.from("guest_list_members").select("guest_request_id, user_id");c&&console.error("Error fetching members",c);let{data:l,error:d}=await a.supabase.from("event_checkins").select("event_id, user_id");d&&console.error("Error fetching checkins",d);let _={};r?.forEach(e=>_[e.id]={invited:0,checkedIn:0});let m=new Map,g=new Set(l?.map(e=>`${e.event_id}:${e.user_id}`));if(n){for(let e of n)if(m.set(e.id,e),_[e.requested_by]){let t=Array.isArray(e.guests)?e.guests.length:0;_[e.requested_by].invited+=t}}if(u)for(let e of u){let t=m.get(e.guest_request_id);t&&_[t.requested_by]&&(_[t.requested_by].invited+=1,t.event_id&&g.has(`${t.event_id}:${e.user_id}`)&&(_[t.requested_by].checkedIn+=1))}return r.map(e=>{let t=_[e.id]||{invited:0,checkedIn:0},s=t.invited>0?Math.round(t.checkedIn/t.invited*100):0;return{id:e.id,name:`${e.name||""} ${e.surname||""}`.trim()||e.email,email:e.email,role:e.role||"Promoter",initials:(e.name?.[0]||"")+(e.surname?.[0]||"")||e.email?.[0]?.toUpperCase()||"?",totalInvited:t.invited,checkedIn:t.checkedIn,status:e.status||"active",isVerified:!0,joinDate:e.created_at,conversionRate:s}})}async getStats(e){let t=await this.getPromoters(e),s=t.length,r=t.filter(e=>"active"===e.status).length,a=t.filter(e=>"pending"===e.status).length,i=t.reduce((e,t)=>e+(t.conversionRate||0),0),n=s>0?Math.round(i/s):0;return{totalPromoters:s,activePromoters:r,pendingPromoters:a,avgConversionRate:n}}async invitePromoter(e,t){throw console.log("Inviting promoter:",e,t),Error("Invite functionality requires backend edge function.")}async updatePromoterStatus(e,t){let{error:s}=await a.supabase.from("crm_users").update({status:t}).eq("id",e);if(s)throw s}}class d{async getStats(e){let{count:t,error:s}=await a.supabase.from("event_checkins").select("event_id, events!inner(venue_id)",{count:"exact",head:!0}).eq("events.venue_id",e);if(s)throw s;let{count:r,error:i}=await a.supabase.from("guest_list_requests").select("id",{count:"exact",head:!0}).eq("venue_id",e);if(i)throw i;let{count:n,error:o}=await a.supabase.from("venue_favorites").select("venue_id",{count:"exact",head:!0}).eq("venue_id",e);if(o)throw o;let{count:u,error:c}=await a.supabase.from("venue_subscriptions").select("venue_id",{count:"exact",head:!0}).eq("venue_id",e);if(c)throw c;return{totalInvitedGuests:r||0,totalCheckins:t||0,totalFavorites:n||0,totalSubscriptions:u||0,conversionRate:r&&t?Math.round(t/r*100):0,conversionChange:0,demographics:{total:100,female:50,male:50},topAge:"21-25",firstTimers:0,repeatGuests:0,noShows:0}}async getGuestTraffic(e){return[]}async getTopPromoters(e){return[]}async getRecentCheckins(e){let{data:t,error:s}=await a.supabase.from("guest_list_requests").select(`
        id,
        created_at,
        status,
        user:users!guest_list_requests_requested_by_fkey (
          id, first_name, last_name, gender_id, dob, genders!users_gender_id_fkey(name)
        )
      `).eq("venue_id",e).eq("status","used").order("created_at",{ascending:!1}).limit(10);if(s)throw s;return(t||[]).map(e=>({id:e.id,guestName:`${e.user?.first_name||""} ${e.user?.last_name||""}`.trim()||"Unknown",guestInitials:`${e.user?.first_name?.[0]||""}${e.user?.last_name?.[0]||""}`.toUpperCase()||"UK",gender:e.user?.genders?.name?.en||e.user?.genders?.name||"Unknown",age:e.user?.dob?new Date().getFullYear()-new Date(e.user.dob).getFullYear():0,promoter:"Direct",time:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"Used"}))}}class _{async getCurrentUser(){let{data:{user:e}}=await a.supabase.auth.getUser();if(!e||!e.email)return null;let{data:t,error:s}=await a.supabase.from("crm_users").select("*").eq("email",e.email).maybeSingle();if(s)throw s;return t}async getUserVenues(e){let{data:t,error:s}=await a.supabase.from("crm_user_venues").select(`
        venue_id,
        venues (*)
      `).eq("crm_user_id",e);if(s)throw s;return(t||[]).map(e=>e.venues).filter(e=>null!==e)}async getUserCompanies(e){let{data:t,error:s}=await a.supabase.from("crm_user_companies").select(`
        company_id,
        companies (*)
      `).eq("crm_user_id",e);if(s)throw s;return(t||[]).map(e=>e.companies).filter(e=>null!==e)}async getUserEvents(e){let{data:t,error:s}=await a.supabase.from("crm_user_events").select(`
        event_id,
        events (*)
      `).eq("crm_user_id",e);if(s)throw s;return(t||[]).map(e=>e.events).filter(e=>null!==e)}}function m({children:e}){let a=(0,s.useMemo)(()=>({authRepository:new i,eventRepository:new n,dashboardRepository:new d,guestListRepository:new c,promoterRepository:new l,crmRepository:new _}),[]);return(0,t.jsx)(r.DependencyProvider,{dependencies:a,children:e})}e.s(["AppDependencies",()=>m],34123)},56872,e=>{"use strict";var t=e.i(43476),s=e.i(86814),r=e.i(12598);e.i(47167);var a=function(){return null};function i({children:e}){return(0,t.jsxs)(r.QueryClientProvider,{client:s.queryClient,children:[e,(0,t.jsx)(a,{initialIsOpen:!1})]})}e.s(["QueryProvider",()=>i],56872)},75696,e=>{"use strict";var t=e.i(61745),s=e.i(43476);function r({locale:e,...r}){if(!e)throw Error(void 0);return(0,s.jsx)(t.IntlProvider,{locale:e,...r})}e.s(["default",()=>r])}]);